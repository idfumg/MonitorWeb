$(function(){"use strict";function e(){for(var e in t)t[e].removeClass("active");for(var n in s)s[n].removeClass("active-container");for(var c in i)i[c].removeClass("active-container")}function n(e,n,c){$(e).each(function(){var e=$(this);e.hasClass(n)?e.toggleClass(c):e.removeClass(c)})}function c(){console.log("Setup main menu...");for(var e in t)t[e].click(function(e){return function(){n(".main-menu .button",e,"active"),n(".containers .container",e,"active-container")}}(e))}function r(){console.log("Setup back buttons...");for(var e in s)s[e].find(".back").click(function(e){return function(){t[e].click()}}(e));for(var n in i)i[n].find(".back").click(function(e){return function(){i[e].toggleClass("active-container")}}(n))}window.get_active_server=function(){var e=s.servers.find(".server").not(".hidden"),n=null;return e.each(function(){$(this).hasClass("active")&&(n=$(this))}),n},window.get_server_events=function(e){var n=[];return a.forEach(function(c){c.server_id===e&&n.push(c)}),n},window.get_server_events_occured=function(e){return void 0===o[e]?[]:o[e]};var t={servers:$(".menu .main-menu .servers")},s={servers:$(".containers .servers"),main_window:$("#scrollbar1")},i={servers_new:$(".containers .servers-new"),datetime:$(".containers .datetime"),events:$(".containers .events")},a={},o={};c(),r();var _=new AjaxApi,l=new WSApi({url:"ws://localhost:8888/ws",connected_callback:function(){_.get_servers(function(e){u.rebuild(e),_.get_servers_events(function(e){a=e.events})}),$(".connect-button").addClass("connected"),u.click_active()},disconnected_callback:function(){$(".connect-button").removeClass("connected")},server_logs_append_callback:function(e,n){v.append_ws(e,n)},event_notify_callback:function(e){u.highlight_server_events_button(e.server_id,e.event_id),void 0===o[e.server_id]&&(o[e.server_id]=[]),o[e.server_id].push(e.event_id)}});l.connect();var v=new MainWindow({main_window:s.main_window,scrollbar:s.main_window,scroll_up_callback:function(e){v.is_search?_.server_search_logs(get_active_server(),$(".search-text").val(),e,d.first_date,d.last_date,function(e,n){v.prepend(e,n)}):v.is_events?console.log("Must be scrolling here"):_.get_servers_logs(get_active_server(),e,function(e,n){v.prepend(e,n)})},main_window_click_callback:function(n){e()}}),u=new Servers({servers:s.servers,servers_new:i.servers_new,events:i.events,new_server_callback:function(e,n,c){_.new_server(e,n,c,function(r){u.add_new_server_record(e,n,c,r.id,!1)})},server_name_clicked_callback:function(e){v.clean(),_.get_servers_logs(e,null,function(n,c){v.append(n,c),v.autoscroll=!0,v.is_search=!1,l.subscribe_server_logs(e.find(".name").text())})},update_server_callback:function(e,n,c,r){_.update_server(e,n,c,r,function(t){u.update_server(r,e,n,c)})},event_clicked_callback:function(e){v.clean(),_.get_event_logs(e,function(e,n){v.append(e,n),v.is_events=!0})}}),d=new SearchFields({search_fields:$(".search-fields"),search_text_callback:function(e,n,c){""!==e?_.server_search_logs(get_active_server(),e,null,n,c,function(e,n){v.clean(),v.is_search=!0,v.append(e,n)}):_.get_servers_logs(get_active_server(),null,function(e,n){v.autoscroll=!0,v.is_search=!1,v.append(e,n),l.subscribe_server_logs(get_active_server())})},connect_button_connected_callback:function(){l.connect()},connect_button_disconnected_callback:function(){l.disconnect()},calendar_button_clicked_callback:function(){n(".containers .container","datetime","active-container")}})});